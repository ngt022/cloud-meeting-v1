import{_ as O,o as T,c as u,a as t,F as U,r as F,b as h,w as j,d,v as m,t as g,e as r,f as S,u as H,g as v}from"./index-CtQw4Fwj.js";const q={class:"home"},x={class:"actions"},B={key:0,class:"history-section"},R={class:"history-list"},P=["onClick"],E={class:"history-info"},L={class:"history-title"},z={class:"history-no"},A={class:"history-time"},G={class:"modal-content"},K={class:"form-group"},Q={class:"form-group"},W={class:"form-group"},X={class:"modal-actions"},Y=["disabled"],Z={class:"modal-content"},ee={class:"form-group"},te={class:"form-group"},se={class:"form-group"},oe={class:"modal-actions"},ae=["disabled"],le={__name:"HomeView",setup(ne){const w=H(),p=r(!1),c=r(!1),y=r(!1),f=r(!1),n=r([]),a=r({title:"",name:"",password:""}),l=r({no:"",name:"",password:""}),N=S(()=>a.value.title.trim()&&a.value.name.trim()),k=S(()=>l.value.no.trim()&&l.value.name.trim());T(()=>{_()});const _=()=>{try{const o=localStorage.getItem("meeting_history");o&&(n.value=JSON.parse(o))}catch(o){console.error("Failed to load history:",o)}},C=o=>{n.value=n.value.filter(e=>e.meetingNo!==o.meetingNo),n.value.unshift({...o,time:Date.now()}),n.value=n.value.slice(0,10),localStorage.setItem("meeting_history",JSON.stringify(n.value))},M=()=>{confirm("确定清除所有历史记录？")&&(n.value=[],localStorage.removeItem("meeting_history"))},V=o=>{const e=new Date(o),i=new Date-e;return i<6e4?"刚刚":i<36e5?`${Math.floor(i/6e4)}分钟前`:i<864e5?`${Math.floor(i/36e5)}小时前`:`${Math.floor(i/864e5)}天前`},I=async o=>{const e=localStorage.getItem("userName")||"匿名用户";w.push({path:`/meeting/${o.meetingNo}`,query:{name:e}})},J=async()=>{if(N.value){y.value=!0;try{const e=await(await fetch("/api/meetings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:a.value.title,hostName:a.value.name,password:a.value.password||void 0})})).json();if(e.success){const s=a.value.name;p.value=!1,a.value={title:"",name:"",password:""},localStorage.setItem("userName",s),C({title:e.data.title,meetingNo:e.data.meetingNo}),w.push({path:`/meeting/${e.data.meetingNo}`,query:{name:s}})}else alert(e.message||"创建失败")}catch{alert("创建失败")}y.value=!1}},D=async()=>{if(k.value){f.value=!0;try{const e=await(await fetch(`/api/meetings/${l.value.no}`)).json();if(e.success){const s=e.data.meeting;if(s.password&&prompt("请输入会议密码")!==s.password){alert("密码错误"),f.value=!1;return}const $=await(await fetch(`/api/meetings/${s.id}/join`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:l.value.name,password:l.value.password||void 0})})).json();if($.success){const b=l.value.name;c.value=!1,l.value={no:"",name:"",password:""},localStorage.setItem("userName",b),C({title:s.title,meetingNo:s.meetingNo}),w.push({path:`/meeting/${s.meetingNo}`,query:{name:b}})}else alert($.message||"加入失败")}else alert(e.message||"会议不存在")}catch{alert("加入失败")}f.value=!1}};return(o,e)=>(v(),u("div",q,[e[22]||(e[22]=t("div",{class:"header"},[t("h1",null,"CloudMeeting"),t("p",null,"极简视频会议 - 无需注册，开箱即用"),t("p",{class:"version"},"v1.0.2")],-1)),t("div",x,[t("button",{class:"btn-primary large",onClick:e[0]||(e[0]=s=>p.value=!0)}," 创建会议 "),t("button",{class:"btn-secondary large",onClick:e[1]||(e[1]=s=>c.value=!0)}," 加入会议 ")]),n.value.length>0?(v(),u("div",B,[e[13]||(e[13]=t("h3",null,"最近会议",-1)),t("div",R,[(v(!0),u(U,null,F(n.value,s=>(v(),u("div",{key:s.meetingNo,class:"history-item",onClick:i=>I(s)},[t("div",E,[t("span",L,g(s.title),1),t("span",z,g(s.meetingNo),1),t("span",A,g(V(s.time)),1)]),e[12]||(e[12]=t("button",{class:"btn-join"},"加入",-1))],8,P))),128))]),t("button",{class:"btn-clear",onClick:M},"清除历史")])):h("",!0),p.value?(v(),u("div",{key:1,class:"modal",onClick:e[6]||(e[6]=j(s=>p.value=!1,["self"]))},[t("div",G,[e[17]||(e[17]=t("h2",null,"创建会议",-1)),t("div",K,[e[14]||(e[14]=t("label",null,"会议名称",-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.title=s),placeholder:"请输入会议名称"},null,512),[[m,a.value.title]])]),t("div",Q,[e[15]||(e[15]=t("label",null,"您的名称",-1)),d(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.name=s),placeholder:"请输入您的名称"},null,512),[[m,a.value.name]])]),t("div",W,[e[16]||(e[16]=t("label",null,"会议密码 (可选)",-1)),d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.password=s),type:"password",placeholder:"留空则无需密码"},null,512),[[m,a.value.password]])]),t("div",X,[t("button",{class:"btn-primary",onClick:J,disabled:!N.value||y.value},g(y.value?"创建中...":"创建会议"),9,Y),t("button",{class:"btn-close",onClick:e[5]||(e[5]=s=>p.value=!1)},"取消")])])])):h("",!0),c.value?(v(),u("div",{key:2,class:"modal",onClick:e[11]||(e[11]=j(s=>c.value=!1,["self"]))},[t("div",Z,[e[21]||(e[21]=t("h2",null,"加入会议",-1)),t("div",ee,[e[18]||(e[18]=t("label",null,"会议号",-1)),d(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.value.no=s),placeholder:"请输入8位会议号"},null,512),[[m,l.value.no]])]),t("div",te,[e[19]||(e[19]=t("label",null,"您的名称",-1)),d(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.name=s),placeholder:"请输入您的名称"},null,512),[[m,l.value.name]])]),t("div",se,[e[20]||(e[20]=t("label",null,"会议密码 (如需)",-1)),d(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.value.password=s),type:"password",placeholder:"留空则无需密码"},null,512),[[m,l.value.password]])]),t("div",oe,[t("button",{class:"btn-primary",onClick:D,disabled:!k.value||f.value},g(f.value?"加入中...":"加入会议"),9,ae),t("button",{class:"btn-close",onClick:e[10]||(e[10]=s=>c.value=!1)},"取消")])])])):h("",!0)]))}},re=O(le,[["__scopeId","data-v-1c669bf9"]]);export{re as default};
